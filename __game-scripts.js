var AudioManager=pc.createScript("audioManager");AudioManager.prototype.initialize=function(){this._registerListeners("on"),this.on("destroy",this._onDestroy,this)},AudioManager.prototype._onDestroy=function(){this._registerListeners("off")},AudioManager.prototype._registerListeners=function(e){};var GameManager=pc.createScript("gameManager");GameManager.attributes.add("playerMaxTime",{type:"number",default:10}),GameManager.attributes.add("mapBounds",{type:"vec3",default:[20,0,20]}),GameManager.attributes.add("collectableTemplates",{type:"asset",assetType:"template",array:!0}),GameManager.prototype.initialize=function(){this._round=!1,this._playing=!1,this._playerTime=0,this._registerListeners("on"),this.on("destroy",this._onDestroy,this)},GameManager.prototype.postInitialize=function(){this._startRound()},GameManager.prototype._onDestroy=function(t){this._registerListeners("off")},GameManager.prototype._startRound=function(t,e){this._round||(this._round=!0,this._playing=!1,this._playerTime=this.playerMaxTime,this.app.fire("roundStart"))},GameManager.prototype.update=function(t){this._playing&&(this._playerTime-=t,this._playerTime<=0&&(this.app.fire("roundOver"),this._playing=!1,this._round=!1))},GameManager.prototype._registerListeners=function(t){this.app[t]("collected",this._onCollected,this)},GameManager.prototype._onCollected=function(t,e){this._round||this._startRound(),this._playing=!0;const a=e||0;this._playerTime=Math.min(this._playerTime+a,this.playerMaxTime),this._spawnCollectable()},GameManager.prototype._spawnCollectable=function(){let t=0,e=0;for(;;){t=(Math.random()-.5)*this.mapBounds.x,e=(Math.random()-.5)*this.mapBounds.z;const a=new pc.Vec3(t,2,e),i=new pc.Vec3(t,.1,e);if(null==this.app.systems.rigidbody.raycastFirst(a,i))break}const a=Math.floor(Math.random()*this.collectableTemplates.length),i=this.collectableTemplates[a].resource.instantiate();i.setPosition(t,0,e),this.entity.addChild(i)},GameManager.prototype.getPlayerTimePercentage=function(){return this._playerTime/this.playerMaxTime};var PlayerController=pc.createScript("playerController");PlayerController.attributes.add("animEntity",{type:"entity",default:"characterMedium"}),PlayerController.attributes.add("power",{type:"number",default:45e4}),PlayerController.prototype.initialize=function(){this._angle=0,this._input=!0,this._frameMovement=new pc.Vec3},PlayerController.prototype.update=function(e){if(this._frameMovement.x=0,this._frameMovement.z=0,this._input&&(this.app.keyboard.isPressed(pc.KEY_A)&&(this._frameMovement.x+=1),this.app.keyboard.isPressed(pc.KEY_D)&&(this._frameMovement.x-=1),this.app.keyboard.isPressed(pc.KEY_W)&&(this._frameMovement.z+=1),this.app.keyboard.isPressed(pc.KEY_S)&&(this._frameMovement.z-=1)),0!==this._frameMovement.x||0!==this._frameMovement.z){this._frameMovement.normalize().scale(this.power*e),this.entity.rigidbody.applyForce(this._frameMovement);const t=90-Math.atan2(this._frameMovement.z,this._frameMovement.x)*pc.math.RAD_TO_DEG;this._angle=pc.math.lerpAngle(this._angle,t,.4)%360}};var UiController=pc.createScript("uiController");UiController.attributes.add("gameManagerEntity",{type:"entity",description:"Entity which contains the 'GameManager' script."}),UiController.attributes.add("timeBarEntity",{type:"entity",description:"Entity which has the UI element representing the remaining time."}),UiController.attributes.add("scoreTextEntity",{type:"entity",description:"Entity which contains the UI text displaying the score."}),UiController.attributes.add("startTextEntity",{type:"entity",description:"Entity which contains the starting text, and will be disabled after starting."}),UiController.attributes.add("roundOverScreenEntity",{type:"entity",description:"Entity which parents all of the 'round over' stuff."}),UiController.attributes.add("roundStartButtonEntity",{type:"entity",description:"Entity which contains a Button that, when pressed, restarts the round."}),UiController.prototype.initialize=function(){this._gameManager=this.gameManagerEntity.script.gameManager,this._scoreText=this.scoreTextEntity.element,this._score=0,this._frameMargin=new pc.Vec4,this._registerListeners("on"),this.on("destroy",this._onDestroy,this)},UiController.prototype._onDestroy=function(){this._registerListeners("off")},UiController.prototype.update=function(t){const e=this.timeBarEntity.parent.element.calculatedWidth,i=(1-this._gameManager.getPlayerTimePercentage())*e;this.timeBarEntity.element.margin=new pc.Vec4(0,0,i,0)},UiController.prototype._registerListeners=function(t){this.app[t]("collected",this._onCollected,this),this.app[t]("roundStart",this._onRoundStart,this),this.app[t]("roundOver",this._onRoundOver,this)},UiController.prototype._onCollected=function(t,e){this.startTextEntity.enabled=!1,this._score++,this._scoreText.text=`Score: ${this._score}`},UiController.prototype._onRoundStart=function(){this.roundOverScreenEntity.enabled=!1,this._score=0,this._scoreText.text=`Score: ${this._score}`},UiController.prototype._onRoundOver=function(){this.roundOverScreenEntity.enabled=!0};